# 2Equilibrium App - Development Status

**Last Updated:** January 26, 2026
**Current Phase:** MVP Complete - Ready for Testing/Deployment

---

## Session Log

### Session: January 26, 2026
**Focus:** Face ID / Biometric Authentication Implementation

**What Was Done:**
1. **Fixed remaining PGRST116 bug** - `getEntryByDate()` still used `.single()`
   - Changed to use `limit(1)` + `order by created_at desc`
   - Files: `src/services/journalService.ts`

2. **Implemented Face ID / Biometric Authentication**
   - Installed `expo-local-authentication` package
   - Created new `biometricService.ts` with full biometric API:
     - `isBiometricSupported()` - Check device capability
     - `getBiometricType()` / `getBiometricLabel()` - Get type (Face ID, Fingerprint)
     - `authenticateWithBiometrics()` - Trigger biometric prompt
     - `saveBiometricCredentials()` / `getBiometricCredentials()` - Secure credential storage
     - `clearBiometricCredentials()` - Remove stored credentials
     - `isBiometricEnabled()` / `isBiometricLoginAvailable()` - Check status
   - Added biometric toggle to Profile Settings with password confirmation modal
   - Added "Sign in with Face ID / Fingerprint" button to Login screen

3. **Fixed Expo Go Compatibility**
   - `expo-local-authentication` requires native build (not available in Expo Go)
   - Added `NativeModules.ExpoLocalAuthentication` check before loading biometric module
   - Biometric features gracefully hidden when native module unavailable
   - App works normally in Expo Go; Face ID only works in development/production builds

4. **Fixed Onboarding Navigation**
   - Added back button (←) to subscription screen
   - Added "Skip" button to bypass subscription during testing
   - Files: `src/app/onboarding/subscription.tsx`

**Files Created:**
- `src/services/biometricService.ts` - Biometric authentication service

**Files Modified:**
- `src/services/journalService.ts` - Fixed `getEntryByDate()` PGRST116 bug
- `src/app/(tabs)/profile.tsx` - Added biometric toggle in Settings section
- `src/app/(auth)/login.tsx` - Added biometric login button
- `src/app/onboarding/subscription.tsx` - Added back/skip navigation
- `package.json` - Added expo-local-authentication dependency

**How Biometric Login Works:**
1. User enables Face ID/Fingerprint in Profile → Settings
2. User enters password to confirm (stored securely in SecureStore)
3. On login screen, user taps "Sign in with Face ID" button
4. Device biometric prompt appears
5. On success, credentials retrieved and auto-login performed

**Committed & Pushed:**
- Commit `3e6d33a` - Add Face ID / biometric authentication
- Commit `c73eab1` - Fix Expo Go compatibility and onboarding navigation
- Commit `639f215` - Fix biometric module loading for development builds

**How to Test Face ID (Simulator):**
1. Create development build: `cd app && npx expo prebuild --clean && npx expo run:ios`
2. In Simulator menu: **Features → Face ID → Enrolled** (check it)
3. Go to Profile → Settings → Toggle "Use Face ID"
4. To simulate scan: **Features → Face ID → Matching Face**

**Important Notes:**
- Face ID/Fingerprint requires a **development build** (not Expo Go)
- In Expo Go, biometric options are automatically hidden
- RevenueCat shows error in Expo Go (expected - needs production config)
- iOS/Android native folders regenerated by prebuild (not committed)

---

### Session: January 25, 2026 (Evening)
**Focus:** Bug fixes and testing on device

**Bugs Fixed:**
1. **Journal editing blocked** - Users couldn't edit saved journal entries
   - Added "Edit Entry" button to allow re-editing after save
   - Files: `src/app/lesson/[id].tsx`

2. **Greeting always showed "Good morning"** - Time-based greeting was hardcoded
   - Now shows morning/afternoon/evening based on current hour
   - Files: `src/app/(tabs)/index.tsx`

3. **Progress showed calendar days instead of completed lessons**
   - `currentDay` was based on days since signup (28 days = 93%)
   - Fixed to show `completedLessons.length + 1` (actual progress)
   - Files: `src/services/progressService.ts`, `src/app/(tabs)/index.tsx`

4. **Lesson access based on time instead of progress**
   - Day 2 was locked because access checked `unlockedDay` (time-based)
   - Fixed to check if previous lesson is completed
   - Files: `src/hooks/useProgress.ts`

5. **Database error PGRST116** - "Multiple rows returned"
   - Caused by duplicate journal entries for same lesson
   - Fixed queries to use `limit(1)` + `order by created_at` instead of `maybeSingle()`
   - Files: `src/services/journalService.ts`

**Files Modified:**
- `src/app/lesson/[id].tsx` - Journal editing, status checking
- `src/app/(tabs)/index.tsx` - Greeting, progress display
- `src/services/progressService.ts` - currentDay calculation
- `src/hooks/useProgress.ts` - Lesson access logic
- `src/services/journalService.ts` - Handle duplicate entries

**Known Issue:**
- Database has duplicate journal entries for some lessons (causes PGRST116)
- App now handles this gracefully, but consider cleaning up Supabase data

**Committed & Pushed:**
- Commit `0d49e89` pushed to `origin/main`
- All bug fixes now on GitHub

---

### Session: January 25, 2026 (Afternoon)
**Focus:** Documentation, content review, and infrastructure planning

**What Was Done:**
- Created `STATUS.md` file for tracking progress across sessions
- Added custom commands to `CLAUDE.md`:
  - `read status` / `status` - Read and summarize current project state
  - `update status` - Update this file with session progress
- Created `Complete_Wellness_Guide_30_Days.html` - Full printable/PDF guide with all 30 days of lesson content
- Reviewed entire codebase to assess current state
- Confirmed MVP is complete and production-ready
- Cloned and analyzed website repo (github.com/emersonader/2equilibrium.com)
- Added website project documentation to STATUS.md and CLAUDE.md
- Analyzed infrastructure/hosting options (VPS vs managed services)

**Infrastructure Decision:**
Evaluated VPS (Vultr) vs current setup. Recommendation: **Stay with current architecture**
- Website: Vercel (free) - React SPA, no server needed
- Backend: Supabase (free-$25/mo) - shared by website + mobile app
- App subscriptions: RevenueCat (free until $2.5k revenue)
- Total cost: $0/month at current scale
- VPS would add cost + maintenance with no benefit

**Files Created/Modified:**
- `/STATUS.md` - Development tracking file
- `/Complete_Wellness_Guide_30_Days.html` - Printable 30-day guide
- `/website/` - Cloned website repo (read-only, no changes without asking)
- `/CLAUDE.md` - Added custom commands and website reference

**Current State:**
- Mobile app: MVP complete, bug fixes applied
- Website: Fully operational on Vercel
- Both share same Supabase backend
- Optimal hosting architecture already in place

---

## App Completion Status

### ✅ Fully Implemented (MVP)

| Feature | Files | Notes |
|---------|-------|-------|
| Authentication | `(auth)/login.tsx`, `signup.tsx`, `forgot-password.tsx` | Email/password with validation |
| Biometric Auth | `services/biometricService.ts`, `(auth)/login.tsx`, `profile.tsx` | Face ID / Fingerprint login |
| Today Screen | `(tabs)/index.tsx` | Daily lesson, streak, progress ring |
| Journey Map | `(tabs)/journey.tsx` | 6 chapters × 5 lessons timeline |
| Journal | `(tabs)/journal.tsx` | Mood/energy/water tracking |
| Nutrition | `(tabs)/nutrition.tsx` | Meal logging, barcode scan, food search |
| Community | `(tabs)/community.tsx` | Feed, posts, follows, encouragement |
| Profile | `(tabs)/profile.tsx` | Stats, badges, health metrics, settings |
| Lesson Detail | `lesson/[id].tsx` | Full content with tabs |
| Chapter Detail | `chapter/[id].tsx` | Overview with lesson list |
| Quiz System | `quiz/[chapterId].tsx`, `quiz/review.tsx` | 70% pass threshold, retry logic |
| Badges | `badges/index.tsx`, `badges/[id].tsx` | 50+ badges with unlock modals |
| Onboarding | `onboarding/` | 4 screens + subscription selection |
| Subscriptions | RevenueCat integration | 3 tiers with feature gating |
| Health Integration | HealthKit (iOS) + Health Connect (Android) | Steps, calories, sleep, weight |

### ⚠️ Pending (Post-MVP / v1.1)

| Feature | Priority | Notes |
|---------|----------|-------|
| Push Notifications | High | `expo-notifications` installed, needs implementation |
| Offline Caching | Medium | `expo-sqlite` installed, not active |
| Voice Notes | Medium | Audio content from Graziella (v1.1) |
| Recipe Library | Low | Feature-flagged, needs screens |
| Movement Video Library | Low | Feature-flagged, needs screens |

---

## Technical Architecture

### State Management (Zustand Stores)
- `userStore` - Auth & profile
- `progressStore` - Lesson/quiz progress, streaks
- `journalStore` - Journal entries
- `subscriptionStore` - RevenueCat integration
- `healthStore` - BMI & weight tracking
- `badgeStore` - Gamification badges
- `communityStore` - Social features
- `nutritionStore` - Food tracking

### Services Layer
- `authService` - Authentication
- `biometricService` - Face ID / Fingerprint authentication
- `progressService` - Lesson progression
- `journalService` - Journal CRUD
- `subscriptionService` - Subscription status
- `revenueCatService` - RevenueCat API
- `badgeService` - Badge awards
- `communityService` - Social features
- `nutritionService` - Food logging
- `healthService` - Health metrics
- `healthConnectService` - Native health APIs

### Content Data
- `chapters.json` - 6 chapters
- `lessons.json` - 30 daily lessons
- `quizzes.json` - 6 chapter quizzes (7-8 questions each)

---

## Recent Changes History

| Date | Commit | Description |
|------|--------|-------------|
| Jan 26, 2026 | 639f215 | Fix biometric module loading for development builds |
| Jan 26, 2026 | c73eab1 | Fix Expo Go compatibility and onboarding navigation |
| Jan 26, 2026 | 3e6d33a | Add Face ID / biometric authentication |
| Jan 25, 2026 | 0d49e89 | Fix lesson progression and journal bugs |
| Jan 2026 | a426293 | Fix hasFeature crash when tier is undefined |
| Jan 2026 | 60b67ed | Fix Android build and add app assets |
| Jan 2026 | f3434c0 | Add website compatibility to mobile app profiles |
| Jan 2026 | d3baae4 | Add gamification badges and community features |
| Jan 2026 | 3d65310 | Fix auth screens: use userStore, add validation, fix navigation |

---

## Next Steps (Suggested)

### Immediate (Testing Phase)
1. [ ] Test full user flow on iOS simulator
2. [ ] Test full user flow on Android emulator
3. [ ] Verify Supabase connection and data persistence
4. [ ] Test RevenueCat subscription purchases (sandbox)
5. [ ] Test HealthKit/Health Connect permissions and data sync

### Short-term (Pre-Launch)
1. [ ] Implement push notifications for daily reminders
2. [ ] Add app store assets (screenshots, descriptions)
3. [ ] Set up TestFlight (iOS) and Internal Testing (Android)
4. [ ] Configure production Supabase environment
5. [ ] Set up RevenueCat production API keys

### Future (v1.1+)
1. [ ] Add voice notes from Graziella
2. [ ] Build recipe library
3. [ ] Add movement video library
4. [ ] Implement offline content caching

---

## Website Project (www.2equilibrium.com)

**Repo:** https://github.com/emersonader/2equilibrium.com.git
**Local Path:** `/Volumes/ExternalHome/Grumpy/2Equilibrium/website`
**Status:** Fully operational

> **IMPORTANT:** Do not make changes to the website without asking first.

### Tech Stack
- React 19 + TypeScript + Vite
- Tailwind CSS
- React Router v6
- Supabase (same backend as app)
- Recharts for data visualization
- Deployed on Vercel

### Key Pages
| Route | Purpose |
|-------|---------|
| `/` | Home - features, pricing, bio |
| `/about` | Graziella's credentials & philosophy |
| `/approach` | 3-step coaching process + FAQ |
| `/blog` | Blog listing |
| `/dashboard` | User check-ins, progress charts |
| `/admin` | Member management, analytics |

### Website Commands
```bash
cd website
npm run dev      # Start dev server (port 3000)
npm run build    # Production build
```

---

## Environment Setup Checklist

### Mobile App (.env)
```bash
EXPO_PUBLIC_SUPABASE_URL=
EXPO_PUBLIC_SUPABASE_ANON_KEY=
EXPO_PUBLIC_REVENUECAT_API_KEY_IOS=
EXPO_PUBLIC_REVENUECAT_API_KEY_ANDROID=
```

### Website (.env.local)
```bash
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
GEMINI_API_KEY=        # optional
EMAIL_ENABLED=false    # optional
```

---

## Notes for Next Session

- Use `read status` or `status` command to get caught up
- Check git status for any uncommitted changes
- Review "Next Steps" section for priorities
- Update this file at the end of each session with `update status` command
- `Complete_Wellness_Guide_30_Days.html` is ready for content review (open in browser, print to PDF)

**From Jan 26 Session:**
- Face ID fully implemented and tested in simulator
- To test Face ID: `cd app && npx expo prebuild --clean && npx expo run:ios`
- Simulator: Features → Face ID → Enrolled, then Matching Face to test
- Onboarding subscription screen has back/skip buttons
- All changes committed and pushed (3 commits today)

**Previous Notes:**
- Consider cleaning up duplicate journal entries in Supabase
- Test the full lesson progression flow: Day 1 → complete journal/movement → Day 2 unlocks

---

*This file is the source of truth for development progress. Update it after each work session.*
